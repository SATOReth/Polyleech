const CONFIG={telegramBot:'Polyleech_bot'};let connectedWallet=null,walletProvider=null;const modal=document.getElementById('wallet-modal'),stepConnect=document.getElementById('step-connect'),stepSign=document.getElementById('step-sign'),stepSuccess=document.getElementById('step-success'),stepError=document.getElementById('step-error');function openModal(){modal.classList.add('active');showStep('connect')}function closeModal(){modal.classList.remove('active')}function showStep(e){stepConnect.classList.add('hidden');stepSign.classList.add('hidden');stepSuccess.classList.add('hidden');stepError.classList.add('hidden');document.getElementById('step-'+e).classList.remove('hidden')}function showError(e){document.getElementById('error-message').textContent=e;showStep('error')}async function connectPhantom(){try{const p=window.phantom?.solana;if(!p?.isPhantom){window.open('https://phantom.app/','_blank');showError('Please install Phantom wallet.');return}const r=await p.connect();connectedWallet=r.publicKey.toString();walletProvider=p;document.getElementById('connected-wallet').textContent=connectedWallet;showStep('sign')}catch(e){showError('Connection rejected.')}}async function connectSolflare(){try{const p=window.solflare;if(!p?.isSolflare){window.open('https://solflare.com/','_blank');showError('Please install Solflare wallet.');return}await p.connect();connectedWallet=p.publicKey.toString();walletProvider=p;document.getElementById('connected-wallet').textContent=connectedWallet;showStep('sign')}catch(e){showError('Failed to connect.')}}async function signVerificationMessage(){if(!connectedWallet||!walletProvider){showError('Wallet not connected.');return}try{const msg='PolyLeech Verification: '+connectedWallet;const encoded=new TextEncoder().encode(msg);await walletProvider.signMessage(encoded,'utf8');document.getElementById('verified-wallet').textContent=connectedWallet.slice(0,4)+'...'+connectedWallet.slice(-4);document.getElementById('leech-balance').textContent='0 $LEECH';document.getElementById('user-tier').textContent='ðŸ‘€ Freebie';localStorage.setItem('polyleech_wallet',connectedWallet);showStep('success')}catch(e){showError('Signature rejected.')}}document.addEventListener('DOMContentLoaded',function(){var btns=[document.getElementById('nav-connect-btn'),document.getElementById('hero-connect-btn'),document.getElementById('cta-connect-btn')];btns.forEach(function(b){if(b)b.addEventListener('click',openModal)});var mc=document.getElementById('modal-close');if(mc)mc.addEventListener('click',closeModal);var mb=document.querySelector('.modal-backdrop');if(mb)mb.addEventListener('click',closeModal);var pb=document.getElementById('connect-phantom-btn');if(pb)pb.addEventListener('click',connectPhantom);var sb=document.getElementById('connect-solflare-btn');if(sb)sb.addEventListener('click',connectSolflare);var sm=document.getElementById('sign-message-btn');if(sm)sm.addEventListener('click',signVerificationMessage);var rb=document.getElementById('retry-btn');if(rb)rb.addEventListener('click',function(){showStep('connect')});var ob=document.getElementById('open-bot-btn');if(ob)ob.addEventListener('click',function(e){e.preventDefault();var w=localStorage.getItem('polyleech_wallet')||'';window.open('https://t.me/'+CONFIG.telegramBot+'?start='+w,'_blank')});var bb=document.getElementById('buy-leech-btn');if(bb)bb.addEventListener('click',function(e){e.preventDefault();window.open('https://raydium.io/swap/','_blank')});document.querySelectorAll('.btn-copy-trader').forEach(function(b){b.addEventListener('click',function(){window.open('https://t.me/'+CONFIG.telegramBot,'_blank')})});var hc=document.querySelector('.hero-card .btn-copy');if(hc)hc.addEventListener('click',function(){window.open('https://t.me/'+CONFIG.telegramBot,'_blank')});document.addEventListener('keydown',function(e){if(e.key==='Escape')closeModal()})});
