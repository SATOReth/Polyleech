const CONFIG={telegramBot:'Polyleech_bot',tiers:[{name:'Freebie',emoji:'ðŸ‘€',minBalance:0},{name:'Leech',emoji:'ðŸ§›',minBalance:100000},{name:'Vampire',emoji:'ðŸ¦‡',minBalance:500000},{name:'Dracula',emoji:'ðŸ°',minBalance:2000000},{name:'Nosferatu',emoji:'ðŸ‘‘',minBalance:10000000}]};let connectedWallet=null,walletProvider=null,telegramLink=null;const modal=document.getElementById('wallet-modal'),stepConnect=document.getElementById('step-connect'),stepSign=document.getElementById('step-sign'),stepSuccess=document.getElementById('step-success'),stepError=document.getElementById('step-error'),connectButtons=[document.getElementById('nav-connect-btn'),document.getElementById('hero-connect-btn'),document.getElementById('cta-connect-btn')];function openModal(){modal.classList.add('active');showStep('connect')}function closeModal(){modal.classList.remove('active')}function showStep(e){stepConnect.classList.add('hidden');stepSign.classList.add('hidden');stepSuccess.classList.add('hidden');stepError.classList.add('hidden');document.getElementById('step-'+e).classList.remove('hidden')}function showError(e){document.getElementById('error-message').textContent=e;showStep('error')}async function connectPhantom(){try{const e=window.phantom?.solana;if(!e?.isPhantom){window.open('https://phantom.app/','_blank');showError('Please install Phantom wallet.');return}const t=await e.connect();connectedWallet=t.publicKey.toString();walletProvider=e;document.getElementById('connected-wallet').textContent=connectedWallet;showStep('sign')}catch(e){showError('Connection rejected. Please try again.')}}async function connectSolflare(){try{const e=window.solflare;if(!e?.isSolflare){window.open('https://solflare.com/','_blank');showError('Please install Solflare wallet.');return}await e.connect();connectedWallet=e.publicKey.toString();walletProvider=e;document.getElementById('connected-wallet').textContent=connectedWallet;showStep('sign')}catch(e){showError('Failed to connect.')}}async function signVerificationMessage(){if(!connectedWallet||!walletProvider){showError('Wallet not connected.');return}try{const e=Date.now(),t='PolyLeech Verification\nWallet: '+connectedWallet+'\nTimestamp: '+e,n=new TextEncoder().encode(t);let o;if(walletProvider.signMessage){const e=await walletProvider.signMessage(n,'utf8');o=e.signature||e}else{throw new Error('Wallet does not support signing')}const s=btoa(String.fromCharCode(...new Uint8Array(o))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=/g,''),a=btoa(JSON.stringify({wallet:connectedWallet,timestamp:e,signature:s})).replace(/\+/g,'-').replace(/\//g,'_').replace(/=/g,'');telegramLink='https://t.me/'+CONFIG.telegramBot+'?start=verify_'+a;const i=getTierByBalance(0);document.getElementById('verified-wallet').textContent=connectedWallet.slice(0,4)+'...'+connectedWallet.slice(-4);document.getElementById('leech-balance').textContent='0 $LEECH';document.getElementById('user-tier').textContent=i.emoji+' '+i.name;showStep('success')}catch(e){showError('Signature rejected. Please try again.')}}function getTierByBalance(e){for(let t=CONFIG.tiers.length-1;t>=0;t--){if(e>=CONFIG.tiers[t].minBalance)return CONFIG.tiers[t]}return CONFIG.tiers[0]}function openTelegramBot(){if(telegramLink){window.open(telegramLink,'_blank')}else{alert('Please verify your wallet first.')}}document.addEventListener('DOMContentLoaded',function(){connectButtons.forEach(function(e){if(e)e.addEventListener('click',openModal)});var e=document.getElementById('modal-close');if(e)e.addEventListener('click',closeModal);var t=document.querySelector('.modal-backdrop');if(t)t.addEventListener('click',closeModal);var n=document.getElementById('connect-phantom-btn');if(n)n.addEventListener('click',connectPhantom);var o=document.getElementById('connect-solflare-btn');if(o)o.addEventListener('click',connectSolflare);var s=document.getElementById('sign-message-btn');if(s)s.addEventListener('click',signVerificationMessage);var a=document.getElementById('retry-btn');if(a)a.addEventListener('click',function(){showStep('connect')});var i=document.getElementById('open-bot-btn');if(i)i.addEventListener('click',function(e){e.preventDefault();openTelegramBot()});var l=document.getElementById('buy-leech-btn');if(l)l.addEventListener('click',function(e){e.preventDefault();window.open('https://raydium.io/swap/','_blank')});document.querySelectorAll('.btn-copy-trader').forEach(function(e){e.addEventListener('click',function(){window.open('https://t.me/'+CONFIG.telegramBot,'_blank')})});var c=document.querySelector('.hero-card .btn-copy');if(c)c.addEventListener('click',function(){window.open('https://t.me/'+CONFIG.telegramBot,'_blank')});document.addEventListener('keydown',function(e){if(e.key==='Escape')closeModal()})});
