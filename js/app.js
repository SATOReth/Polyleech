const CONFIG={telegramBot:'Polyleech_bot',leechTokenMint:'So11111111111111111111111111111111111111112',tiers:[{name:'Freebie',emoji:'ðŸ‘€',minBalance:0},{name:'Leech',emoji:'ðŸ§›',minBalance:100000},{name:'Vampire',emoji:'ðŸ¦‡',minBalance:500000},{name:'Dracula',emoji:'ðŸ°',minBalance:2000000},{name:'Nosferatu',emoji:'ðŸ‘‘',minBalance:10000000}]};let connectedWallet=null,walletProvider=null,verificationData=null;const modal=document.getElementById('wallet-modal'),modalClose=document.getElementById('modal-close'),stepConnect=document.getElementById('step-connect'),stepSign=document.getElementById('step-sign'),stepSuccess=document.getElementById('step-success'),stepError=document.getElementById('step-error'),connectButtons=[document.getElementById('nav-connect-btn'),document.getElementById('hero-connect-btn'),document.getElementById('cta-connect-btn')];function openModal(){modal.classList.add('active');showStep('connect')}function closeModal(){modal.classList.remove('active')}function showStep(e){stepConnect.classList.add('hidden');stepSign.classList.add('hidden');stepSuccess.classList.add('hidden');stepError.classList.add('hidden');switch(e){case'connect':stepConnect.classList.remove('hidden');break;case'sign':stepSign.classList.remove('hidden');break;case'success':stepSuccess.classList.remove('hidden');break;case'error':stepError.classList.remove('hidden');break}}function showError(e){document.getElementById('error-message').textContent=e;showStep('error')}async function connectPhantom(){try{const e=window.phantom?.solana;if(!e?.isPhantom){window.open('https://phantom.app/','_blank');showError('Please install Phantom wallet and refresh the page.');return}const t=await e.connect();connectedWallet=t.publicKey.toString();walletProvider=e;document.getElementById('connected-wallet').textContent=connectedWallet;showStep('sign')}catch(e){console.error('Phantom connection error:',e);if(e.code===4001){showError('Connection rejected. Please try again.')}else{showError('Failed to connect. Please try again.')}}}async function connectSolflare(){try{const e=window.solflare;if(!e?.isSolflare){window.open('https://solflare.com/','_blank');showError('Please install Solflare wallet and refresh the page.');return}await e.connect();connectedWallet=e.publicKey.toString();walletProvider=e;document.getElementById('connected-wallet').textContent=connectedWallet;showStep('sign')}catch(e){console.error('Solflare connection error:',e);showError('Failed to connect. Please try again.')}}async function signVerificationMessage(){if(!connectedWallet||!walletProvider){showError('Wallet not connected. Please try again.');return}try{const e=Date.now(),t='PolyLeech Verification\nWallet: '+connectedWallet+'\nTimestamp: '+e,n=new TextEncoder().encode(t);let o;if(walletProvider.signMessage){const e=await walletProvider.signMessage(n,'utf8');o=e.signature||e}else{throw new Error('Wallet does not support message signing')}const a=btoa(String.fromCharCode(...new Uint8Array(o))),s=btoa(JSON.stringify({wallet:connectedWallet,timestamp:e,signature:a}));verificationData={wallet:connectedWallet,token:s};const i=await getLeechBalance(connectedWallet),l=getTierByBalance(i);document.getElementById('verified-wallet').textContent=shortenAddress(connectedWallet);document.getElementById('leech-balance').textContent=formatNumber(i)+' $LEECH';document.getElementById('user-tier').textContent=l.emoji+' '+l.name;const c='https://t.me/'+CONFIG.telegramBot+'?start=verify_'+s,r=document.getElementById('open-bot-btn');if(r){r.setAttribute('href',c);r.setAttribute('target','_blank')}showStep('success')}catch(e){console.error('Signing error:',e);if(e.code===4001){showError('Signature rejected. Please try again.')}else{showError('Failed to sign message. Please try again.')}}}async function getLeechBalance(e){return 0}function getTierByBalance(e){for(let t=CONFIG.tiers.length-1;t>=0;t--){if(e>=CONFIG.tiers[t].minBalance){return CONFIG.tiers[t]}}return CONFIG.tiers[0]}function shortenAddress(e){if(!e)return'';return e.slice(0,4)+'...'+e.slice(-4)}function formatNumber(e){return new Intl.NumberFormat().format(e)}function handleCopyTrader(e){if(!verificationData){alert('Please connect and verify your wallet first!');openModal();return}const t='https://t.me/'+CONFIG.telegramBot+'?start=copy_'+e;window.open(t,'_blank')}document.addEventListener('DOMContentLoaded',function(){connectButtons.forEach(function(e){if(e){e.addEventListener('click',openModal)}});if(modalClose){modalClose.addEventListener('click',closeModal)}var e=document.querySelector('.modal-backdrop');if(e){e.addEventListener('click',closeModal)}var t=document.getElementById('connect-phantom-btn');if(t){t.addEventListener('click',connectPhantom)}var n=document.getElementById('connect-solflare-btn');if(n){n.addEventListener('click',connectSolflare)}var o=document.getElementById('sign-message-btn');if(o){o.addEventListener('click',signVerificationMessage)}var a=document.getElementById('retry-btn');if(a){a.addEventListener('click',function(){showStep('connect')})}var s=document.querySelectorAll('.btn-copy-trader');s.forEach(function(e){e.addEventListener('click',function(){var t=e.getAttribute('data-wallet');handleCopyTrader(t)})});var i=document.querySelector('.hero-card .btn-copy');if(i){i.addEventListener('click',function(){handleCopyTrader('0x8dxd7f3a2b1c4d5e6f7a8b9c0d1e2f3a4b5c6d7e')})}var l=document.getElementById('buy-leech-btn');if(l){l.addEventListener('click',function(e){e.preventDefault();window.open('https://raydium.io/swap/','_blank')})}document.addEventListener('keydown',function(e){if(e.key==='Escape')closeModal()});var c=document.querySelectorAll('a[href^="#"]');c.forEach(function(e){e.addEventListener('click',function(t){t.preventDefault();var n=this.getAttribute('href'),o=document.querySelector(n);if(o){o.scrollIntoView({behavior:'smooth',block:'start'})}})});window.addEventListener('scroll',function(){var e=document.querySelector('.navbar'),t=window.pageYOffset;if(t>100){e.style.background='rgba(10, 10, 15, 0.95)'}else{e.style.background='rgba(10, 10, 15, 0.8)'}})});window.addEventListener('load',function(){var e=window.phantom?.solana;if(e?.isConnected&&e?.publicKey){connectedWallet=e.publicKey.toString();walletProvider=e;connectButtons.forEach(function(e){if(e&&connectedWallet){e.innerHTML='<span>ðŸŸ¢ '+shortenAddress(connectedWallet)+'</span>'}})}});
